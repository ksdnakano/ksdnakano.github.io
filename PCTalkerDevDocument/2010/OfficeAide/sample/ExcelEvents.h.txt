#pragma once
#include "oaidl.h"
#include "EventDispatch.h"

//00024413-0000-0000-C000-000000000046
const IID IID_ExcelAppEvents  = {0x00024413,0x0000,0x0000,{0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x46}};

//	イベントDISPID定義
#define	DISPID_SHEETACTIVE				0x00000619
#define DISPID_SHEETCHANGE				0x0000061c
#define DISPID_NEWWORKBOOK              0x0000061d
#define	DISPID_SHEETSELECTIONCHANGE		0x00000616
#define	DISPID_WORKBOOKOPEN				0x0000061f
#define	DISPID_WORKBOOKACTIVE			0x00000620

enum DISPID_EXCELAPP_EVENTS{
		DISPID_EXCELAPP_SHEETSELECTIONCHANGE = 0x00000616,
		DISPID_EXCELAPP_SHEETBEFOREDOUBLECLICK,
		DISPID_EXCELAPP_SHEETBEFORERIGHTCLICK,
		DISPID_EXCELAPP_SHEETACTIVATE,
		DISPID_EXCELAPP_SHEETDEACTIVATE,
		DISPID_EXCELAPP_SHEETCALCULATE,
		DISPID_EXCELAPP_SHEETCHANGE,
		DISPID_EXCELAPP_NEWWORKBOOK = 0x0000061d,
		DISPID_EXCELAPP_WORKBOOKOPEN = 0x0000061f,
		DISPID_EXCELAPP_WORKBOOKACTIVATE,
		DISPID_EXCELAPP_WORKBOOKDEACTIVATE,
		DISPID_EXCELAPP_WORKBOOKBEFORECLOSE,
		DISPID_EXCELAPP_WORKBOOKBEFORESAVE,
		DISPID_EXCELAPP_WORKBOOKBEFOREPRINT,
		DISPID_EXCELAPP_WORKBOOKNEWSHEET,
		DISPID_EXCELAPP_WORKBOOKADDININSTALL,
		DISPID_EXCELAPP_WORKBOOKADDINUNINSTALL,
		DISPID_EXCELAPP_WINDOWRESIZE = 0x00000612,
		DISPID_EXCELAPP_WINDOWACTIVATE = 0x00000614,
		DISPID_EXCELAPP_WINDOWDEACTIVATE,
		DISPID_EXCELAPP_SHEETFOLLOWHYPERLINK = 0x0000073e,
		DISPID_EXCELAPP_SHEETPIVOTTABLEUPDATE= 0x0000086d,
		DISPID_EXCELAPP_WORKBOOKPIVOTTABLECLOSECONNECTION = 0x00000870,
		DISPID_EXCELAPP_WORKBOOKPIVOTTABLEOPENCONNECTION,
		DISPID_EXCELAPP_WORKBOOKSYNC = 0x000008f1,
		DISPID_EXCELAPP_WORKBOOKBEFOREXMLIMPORT,
		DISPID_EXCELAPP_WORKBOOKAFTERXMLIMPORT,
		DISPID_EXCELAPP_WORKBOOKBEFOREXMLEXPORT,
		DISPID_EXCELAPP_WORKBOOKAFTERXMLEXPORT,
		DISPID_EXCELAPP_WORKBOOKROWSETCOMPLETE = 0x00000a33,
		DISPID_EXCELAPP_AFTERCALCULATE,
};

/*
void NewWorkbook([in] Workbook* Wb);
void WorkbookActive([in] Workbook* Wb);
void WorkbookOpen([in] Workbook* Wb);
void SheetActive(([in] IDispatch* Sh);
void SheetChange([in] IDispatch* Sh, [in] Range* Target);
void SheetSelectionChange([in] IDispatch* Sh, [in] Range* Target);
*/
class CExcelEvents : public CEventDispatch
{
public:
	CExcelEvents() :	CEventDispatch( IID_ExcelAppEvents ){	;	}
	~CExcelEvents(void){	;	}

   STDMETHODIMP Invoke(DISPID dispIdMember, REFIID riid, LCID lcid,WORD wFlags, DISPPARAMS* pDispParams,
      VARIANT* pVarResult, EXCEPINFO* pExcepInfo, UINT* puArgErr);

   // Event Handler
/*	STDMETHODIMP OnNewWorkbook( Workbook* Wb);
	STDMETHODIMP OnWorkbookActive( Workbook* Wb);
	STDMETHODIMP OnWorkbookOpen( Workbook* Wb);
	STDMETHODIMP OnSheetActive(( IDispatch* Sh);
	STDMETHODIMP OnSheetChange( IDispatch* Sh,  Range* Target);
*/	STDMETHODIMP OnSheetChange( IDispatch* xlSheet, IDispatch* xlRange);
//	STDMETHODIMP OnSheetSelectionChange( IDispatch* Sh, Range* Target);
};
